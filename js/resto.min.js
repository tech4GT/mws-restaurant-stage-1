let restaurant;var map;"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})}),window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name+'  <i id="fav"></i>';const t=document.getElementById("fav");DBHelper.getDB(n=>{n.transaction("favs").objectStore("favs").get(parseInt(e.id)).onsuccess=function(r){r.target.result.starred?t.setAttribute("class","fa fa-star"):t.setAttribute("class","fa fa-star-o");var a=r.target.result.starred;t.addEventListener("click",function(){a=!a;var t=this,r=["fa fa-star","fa fa-star-o"];n.transaction("favs","readwrite").objectStore("favs").put({id:e.id,starred:a}).onsuccess=(()=>{t.setAttribute("class",r[(r.indexOf(this.getAttribute("class"))+1)%2])})})}}),document.getElementById("restaurant-img").alt=`Restaurant ${e.name}`,document.getElementById("restaurant-address").innerHTML=e.address;const n=document.getElementById("restaurant-img");n.className="restaurant-img",n.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fetch(`http://localhost:1337/reviews/?restaurant_id=${e.id}`).then(e=>{e.json().then(e=>{fillReviewsHTML(e)})}).catch(()=>{DBHelper.getDB(t=>{t.transaction("restaurants").objectStore("restaurants").get(parseInt(e.id)).onsuccess=function(e){fillReviewsHTML(e.target.result.reviews)}})})}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const s=document.createElement("td");s.innerHTML=e[n],r.appendChild(s),t.appendChild(r)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h3");n.innerHTML='Reviews  <i id="openModal" class = "fa fa-pencil-square-o"></i>',t.appendChild(n);const r=document.getElementById("openModal");r.style.cursor="pointer";const a=document.getElementById("myModal");if(r.addEventListener("click",()=>{a.style.display="block"}),document.getElementsByClassName("close")[0].onclick=function(){a.style.display="none"},window.onclick=function(e){e.target==a&&(a.style.display="none")},!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const s=document.getElementById("reviews-list");e.forEach(e=>{s.appendChild(createReviewHTML(e))}),t.appendChild(s)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=new Date(e.updatedAt),t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const s=document.createElement("p");return s.innerHTML=e.comments,t.appendChild(s),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});